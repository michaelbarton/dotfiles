---
# Main Ansible playbook for managing dotfiles
# This playbook handles:
# - Creating necessary directories
# - Setting up Neovim configuration
# - Configuring OS-specific launch agents
# - Linking dotfiles to their proper locations
#
# To run only specific tags: ./apply_ansible [tag1,tag2]
# Available tags: links, python, agents

- name: Playbook to manage dotfiles
  hosts: localhost
  connection: local
  vars:
    venv_path: "{{ ansible_env.HOME }}/.venvs"
    python_version: "3.11" # Adjust this to your preferred Python version
    dotfiles_dir: "{{ ansible_env.HOME }}/.dotfiles"
    config_dir: "{{ ansible_user_dir }}/.config"

  tasks:
    - name: Create necessary directories
      ansible.builtin.file:
        path: "{{ item.path }}"
        state: directory
        mode: "{{ item.mode | default('0755') }}"
      loop:
        - { path: "{{ config_dir }}/fish" }
        - { path: "{{ config_dir }}/nvim/autoload" }
        - { path: "{{ config_dir }}/plugged" }
        - { path: "{{ config_dir }}/ghostty" }
        - { path: "{{ config_dir }}/atuin" }
        - { path: "{{ config_dir }}/lazygit" }
        - { path: "{{ ansible_user_dir }}/cache" }
        - { path: "{{ ansible_user_dir }}/.bin" }
        - { path: "{{ ansible_user_dir }}/.hammerspoon" }
        - { path: "{{ ansible_user_dir }}/.ssh/sockets", mode: "0700" }
        - { path: "{{ ansible_user_dir }}/.local/share" }
        - { path: "{{ ansible_user_dir }}/.cache" }
        - { path: "{{ ansible_user_dir }}/.local/state" }
      tags:
        - always

    - name: Include Neovim setup tasks
      include_tasks: tasks/neovim.yml
      tags:
        - python
        - nvim

    - name: Include OS-specific launch agents
      include_tasks: tasks/launch_agents.yml
      tags:
        - agents

    - name: Include dotfile linking tasks
      include_tasks: tasks/link_files.yml
      tags:
        - links
        - setup
